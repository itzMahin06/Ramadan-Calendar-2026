<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>মাহে রমাদান-২০২৬</title>
<link href="https://fonts.maateen.me/solaiman-lipi/font.css" rel="stylesheet">
<style>
:root{
--primary:#0d5c3e;
--accent:#ffcc00;
--bg:linear-gradient(135deg,#1a4a3a,#0d2b21);
}

body{
margin:0;
font-family:'SolaimanLipi',sans-serif;
background:var(--bg);
color:white;
padding-top:140px;
position: relative;
}

.header{
position:fixed;
top:0;
width:100%;
background:linear-gradient(135deg,#145c42,#0d3c2b);
padding:15px 10px;
text-align:center;
transition:.3s;
z-index:1000;
box-shadow:0 4px 15px rgba(0,0,0,0.4);
box-sizing: border-box;
}

.header.small{padding:5px 10px;}
.header h1{margin:0; color:var(--accent); font-size: 1.4rem;}
.header-info{font-size:0.8rem; margin-top:5px; line-height: 1.4;}

.container{max-width:1100px; margin:auto; padding:10px;}

/* বাটন ও সিলেক্ট এরিয়া */
.action-bar {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    margin: 15px 0;
}

select {
    padding:8px 15px;
    border-radius:8px;
    border:none;
    font-family:inherit;
    cursor: pointer;
    background: white;
}

.prayer-btn {
    padding: 8px 15px;
    border-radius: 8px;
    border: none;
    background: var(--accent);
    color: #000;
    font-family: inherit;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
}

.prayer-btn:hover { background: #e6b800; }

/* মডাল স্টাইল */
.modal {
    display: none;
    position: fixed;
    z-index: 2001;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.8);
    backdrop-filter: blur(5px);
}

.modal-content {
    background: #145c42;
    margin: 15% auto;
    padding: 20px;
    border: 2px solid var(--accent);
    width: 80%;
    max-width: 400px;
    border-radius: 15px;
    text-align: center;
    position: relative;
}

.close-btn {
    position: absolute;
    right: 15px;
    top: 10px;
    font-size: 24px;
    cursor: pointer;
    color: var(--accent);
}

.prayer-list {
    text-align: left;
    margin-top: 15px;
}

.prayer-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.cards{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(290px,1fr));
gap:15px;
}

.card{
background:rgba(255,255,255,0.08);
padding:15px;
border-radius:15px;
position: relative;
display: flex;
flex-direction: column;
justify-content: center;
min-height: 115px;
border: 1px solid rgba(255,255,255,0.1);
}

.card-content { width: 55%; }

.highlight{
border:2px solid var(--accent);
background:rgba(255,204,0,0.15);
}

.countdown{
position: absolute;
right: 12px;
top: 50%;
transform: translateY(-50%);
text-align: right;
font-size: 0.75rem;
color: var(--accent);
width: 42%;
font-weight: bold;
line-height: 1.5;
}

.watermark {
position: fixed;
bottom: 15px;
right: 15px;
opacity: 0.6;
font-size: 12px;
color: #fff;
z-index: 2000;
background: rgba(0,0,0,0.4);
padding: 4px 8px;
border-radius: 4px;
}
</style>
</head>

<body>

<div class="watermark">ডেভেলপ: মাহিন</div>

<div class="header" id="header">
<h1>মাহে রমাদান-২০২৬</h1>
<div class="header-info" id="header-info"></div>
</div>

<div class="container">
    <div class="action-bar">
        <div>
            <label>জেলা:</label>
            <select id="district" onchange="fetchRamadanData()">
                <option value="Mymensingh">ময়মনসিংহ</option>
                <option value="Jamalpur">জামালপুর</option>
                <option value="Sherpur">শেরপুর</option>
                <option value="Netrokona">নেত্রকোণা</option>
            </select>
        </div>
        <button class="prayer-btn" onclick="showPrayerTimes()">আজকের নামাজের সময়সূচি</button>
    </div>

    <div class="cards" id="ramadan-cards"></div>
</div>

<div id="prayerModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h3 style="color:var(--accent); margin-bottom: 5px;">নামাজের সময়সূচি</h3>
        <p id="modal-district-name" style="margin: 0; font-size: 0.9rem;"></p>
        <hr style="border: 0.5px solid rgba(255,255,255,0.2); margin: 15px 0;">
        <div id="prayer-list" class="prayer-list"></div>
        <p style="font-size: 0.7rem; margin-top: 15px; color: #ccc;">* মার্ক করা সময়গুলো ওয়াক্ত শুরুর সময় নির্দেশ করে।</p>
    </div>
</div>

<script>
let ramadanData=[];
let fullMonthData = []; // সব ডেটা স্টোর করার জন্য
let timer;

const ordinalMap = ["", "১ম", "২য়", "৩য়", "৪র্থ", "৫ম", "৬ষ্ঠ", "৭ম", "৮ম", "৯ম", "১০ম", "১১ তম", "১২ তম", "১৩ তম", "১৪ তম", "১৫ তম", "১৬ তম", "১৭ তম", "১৮ তম", "১৯ তম", "২০ তম", "২১ তম", "২২ তম", "২৩ তম", "২৪ তম", "২৫ তম", "২৬ তম", "২৭ তম", "২৮ তম", "২৯ তম", "৩০ তম"];

function toBangla(num){
    return num.toString().padStart(2, '0').replace(/\d/g, d => "০১২৩৪৫৬৭৮৯"[d]);
}

function formatTime(t){
    if(!t) return "";
    let [h, m] = t.split(":");
    h = parseInt(h);
    let ampm = h >= 12 ? "" : "";
    h = h % 12 || 12;
    return `${toBangla(h)}:${toBangla(m)} ${ampm}`;
}

function districtBangla(val){
    const map = {"Mymensingh":"ময়মনসিংহ","Jamalpur":"জামালপুর","Sherpur":"শেরপুর","Netrokona":"নেত্রকোণা"};
    return map[val] || val;
}

function formatDateBN(dateStr){
    const [d, m, y] = dateStr.split("-");
    const dateObj = new Date(y, m-1, d);
    const weekday = dateObj.toLocaleDateString("bn-BD", {weekday:"long"});
    const dayMonth = dateObj.toLocaleDateString("bn-BD", {day:"numeric", month:"long"});
    return `${weekday}, ${dayMonth}`;
}

function updateHeader(){
    const now = new Date();
    const date = now.toLocaleDateString("bn-BD", {weekday:"long", year:"numeric", month:"long", day:"numeric"});
    const time = now.toLocaleTimeString("bn-BD");
    const district = districtBangla(document.getElementById("district").value);
    document.getElementById("header-info").innerHTML = `${date} <br> সময়: ${time} | জেলা: ${district}`;
}
setInterval(updateHeader, 1000);

async function fetchRamadanData(){
    const district = document.getElementById("district").value;
    const container = document.getElementById("ramadan-cards");
    container.innerHTML = "<p style='text-align:center; width:100%'>তথ্য লোড হচ্ছে...</p>";

    try {
        const [resFeb, resMar] = await Promise.all([
            fetch(`https://api.aladhan.com/v1/calendarByCity/2026/2?city=${district}&country=Bangladesh&method=1&adjustment=0`),
            fetch(`https://api.aladhan.com/v1/calendarByCity/2026/3?city=${district}&country=Bangladesh&method=1&adjustment=0`)
        ]);
        
        const dataFeb = await resFeb.json();
        const dataMar = await resMar.json();
        fullMonthData = [...dataFeb.data, ...dataMar.data];
        
        const startDate = "19-02-2026";
        const startIndex = fullMonthData.findIndex(d => d.date.gregorian.date === startDate);
        
        ramadanData = startIndex !== -1 ? fullMonthData.slice(startIndex, startIndex + 30) : [];

        renderCards();
        startLiveUpdate();
    } catch (e) { container.innerHTML = "ডেটা লোড করতে ব্যর্থ!"; }
}

// নামাজের সময় দেখানোর ফাংশন
function showPrayerTimes() {
    const now = new Date();
    const todayStr = ("0" + now.getDate()).slice(-2) + "-" + ("0" + (now.getMonth() + 1)).slice(-2) + "-" + now.getFullYear();
    const todayData = fullMonthData.find(d => d.date.gregorian.date === todayStr);

    if (todayData) {
        const prayers = [
            { name: "ফজর", time: todayData.timings.Fajr },
            { name: "যোহর", time: todayData.timings.Dhuhr },
            { name: "আসর", time: todayData.timings.Asr },
            { name: "মাগরিব (ইফতার)", time: todayData.timings.Maghrib },
            { name: "এশা", time: todayData.timings.Isha }
        ];

        let html = "";
        prayers.forEach(p => {
            html += `<div class="prayer-item">
                        <span>* ${p.name}</span>
                        <span style="color:var(--accent)">${formatTime(p.time.split(" ")[0])}</span>
                    </div>`;
        });

        document.getElementById("modal-district-name").innerText = "জেলা: " + districtBangla(document.getElementById("district").value);
        document.getElementById("prayer-list").innerHTML = html;
        document.getElementById("prayerModal").style.display = "block";
    } else {
        alert("আজকের তথ্য পাওয়া যায়নি!");
    }
}

function closeModal() {
    document.getElementById("prayerModal").style.display = "none";
}

// বাইরের জায়গায় ক্লিক করলে মডাল বন্ধ হবে
window.onclick = function(event) {
    if (event.target == document.getElementById("prayerModal")) {
        closeModal();
    }
}

function renderCards(){
    const container = document.getElementById("ramadan-cards");
    container.innerHTML = "";
    const now = new Date();
    const todayStr = ("0" + now.getDate()).slice(-2) + "-" + ("0" + (now.getMonth() + 1)).slice(-2) + "-" + now.getFullYear();

    ramadanData.forEach((day, index) => {
        const card = document.createElement("div");
        card.className = "card";
        if(day.date.gregorian.date === todayStr) card.classList.add("highlight");

        card.innerHTML = `
            <div class="card-content">
                <strong style="color:var(--accent)">${ordinalMap[index+1]} রমাদান</strong>
                <div style="font-size:0.95rem; margin-bottom:4px;">${formatDateBN(day.date.gregorian.date)}</div>
                <div style="font-size:0.85rem;">সেহরি শেষ: ${formatTime(day.timings.Fajr.split(" ")[0])}</div>
                <div style="font-size:0.85rem;">ইফতার: ${formatTime(day.timings.Maghrib.split(" ")[0])}</div>
            </div>
            <div class="countdown" id="cd-${index}">হিসাব হচ্ছে...</div>
        `;
        container.appendChild(card);
    });
}

function startLiveUpdate(){
    if(timer) clearInterval(timer);
    timer = setInterval(() => {
        const now = new Date();
        const todayNoTime = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
        
        ramadanData.forEach((day, index) => {
            const el = document.getElementById(`cd-${index}`);
            if(!el) return;

            const [d, m, y] = day.date.gregorian.date.split("-");
            const [sh, sm] = day.timings.Fajr.split(" ")[0].split(":");
            const [ih, im] = day.timings.Maghrib.split(" ")[0].split(":");

            const sehriTime = new Date(y, m-1, d, sh, sm);
            const iftarTime = new Date(y, m-1, d, ih, im);
            const cardDate = new Date(y, m-1, d);
            const cardDateTime = cardDate.getTime();

            if (cardDateTime === todayNoTime) {
                if(now < sehriTime){
                    el.innerHTML = `সেহরি বাকি:<br><span style="color:#fff">${getExactTimeStr(sehriTime - now)}</span>`;
                } else if(now < iftarTime){
                    el.innerHTML = `<span style="color:#00ff88">সেহরি সম্পন্ন</span><br>ইফতার বাকি:<br><span style="color:#fff">${getExactTimeStr(iftarTime - now)}</span>`;
                } else {
                    if(ramadanData[index+1]){
                        const nextDay = ramadanData[index+1];
                        const [nd, nm, ny] = nextDay.date.gregorian.date.split("-");
                        const [nsh, nsm] = nextDay.timings.Fajr.split(" ")[0].split(":");
                        const nextSehriTime = new Date(ny, nm-1, nd, nsh, nsm);
                        el.innerHTML = `<span style="color:#00ff88">ইফতার সম্পন্ন</span><br>পরবর্তী সেহরি বাকি:<br><span style="color:#fff">${getExactTimeStr(nextSehriTime - now)}</span>`;
                    } else {
                        el.innerHTML = `<span style="color:#00ff88">ইফতার সম্পন্ন</span>`;
                    }
                }
            } else if (cardDateTime < todayNoTime) {
                el.innerHTML = "সম্পন্ন";
                el.style.opacity = "0.5";
            } else {
                el.innerHTML = "আসন্ন";
            }
        });
    }, 1000);
}

function getExactTimeStr(ms){
    let totalSec = Math.floor(ms / 1000);
    let h = Math.floor(totalSec / 3600);
    let m = Math.floor((totalSec % 3600) / 60);
    let s = totalSec % 60;
    return `${toBangla(h)}ঘ:${toBangla(m)}মি:${toBangla(s)}সে`;
}

fetchRamadanData();

window.addEventListener("scroll", () => {
    document.getElementById("header").classList.toggle("small", window.scrollY > 30);
});
</script>

</body>
</html>
